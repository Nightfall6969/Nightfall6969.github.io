<!DOCTYPE html>
<html>
<head>
    <title>Quiz Scores</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f0f2f5; }
        .container { max-width: 800px; margin: 0 auto; }
        .score-card { 
            background: white; 
            padding: 20px; 
            margin: 10px 0; 
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 10px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #4CAF50; color: white; }
        .completed { color: green; font-weight: bold; }
        .export-btn {
            background: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š ICT Quiz Scores</h1>
        
        <button class="export-btn" onclick="exportScores()">ðŸ“¥ Export Scores as JSON</button>
        <button class="export-btn" onclick="exportCSV()">ðŸ“¥ Export as CSV</button>
        
        <div class="score-card">
            <h3>Student Progress</h3>
            <table id="scoreTable">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Quizzes Done</th>
                        <th>Total Score</th>
                        <th>Average</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="scoreBody">
                </tbody>
            </table>
        </div>
        
        <div class="score-card">
            <h3>Detailed Scores</h3>
            <table id="detailTable">
                <thead>
                    <tr>
                        <th>Student</th>
                        <th>Quiz</th>
                        <th>Score</th>
                        <th>Date</th>
                    </tr>
                </thead>
                <tbody id="detailBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        // Load scores from localStorage
        let allScores = JSON.parse(localStorage.getItem('quizScores')) || [];
        
        function displayScores() {
            // Group by student
            let students = {};
            allScores.forEach(score => {
                if(!students[score.student]) {
                    students[score.student] = {
                        scores: [],
                        total: 0,
                        count: 0
                    };
                }
                students[score.student].scores.push(score);
                students[score.student].total += score.score;
                students[score.student].count++;
            });
            
            // Display summary
            let summaryHtml = '';
            let detailHtml = '';
            
            for(let student in students) {
                let data = students[student];
                let avg = (data.total / (data.count * 20) * 100).toFixed(1);
                let status = data.count === 20 ? 'âœ… Completed' : `${data.count}/20 done`;
                
                summaryHtml += `<tr>
                    <td>${student}</td>
                    <td>${data.count}/20</td>
                    <td>${data.total}/${data.count * 20}</td>
                    <td>${avg}%</td>
                    <td class="${data.count === 20 ? 'completed' : ''}">${status}</td>
                </tr>`;
                
                // Detailed scores
                data.scores.sort((a,b) => a.quiz - b.quiz).forEach(s => {
                    detailHtml += `<tr>
                        <td>${s.student}</td>
                        <td>Quiz ${s.quiz}</td>
                        <td>${s.score}/${s.total}</td>
                        <td>${new Date(s.date).toLocaleDateString()}</td>
                    </tr>`;
                });
            }
            
            document.getElementById('scoreBody').innerHTML = summaryHtml || '<tr><td colspan="5">No scores yet</td></tr>';
            document.getElementById('detailBody').innerHTML = detailHtml || '<tr><td colspan="4">No scores yet</td></tr>';
        }
        
        function exportScores() {
            const dataStr = JSON.stringify(allScores, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'all_quiz_scores.json');
            linkElement.click();
        }
        
        function exportCSV() {
            let csv = 'Student,Quiz,Score,Total,Date\n';
            allScores.forEach(s => {
                csv += `${s.student},${s.quiz},${s.score},${s.total},${s.date}\n`;
            });
            
            const dataUri = 'data:text/csv;charset=utf-8,'+ encodeURIComponent(csv);
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', 'quiz_scores.csv');
            linkElement.click();
        }
        
        displayScores();
    </script>
</body>
</html>
